---
title: "Skyline Behaviour Results Efficacy response"
output: html_notebook
date: 2019-09-12
---


```{r}
library(tidyverse)
library(lubridate)
```

Get daily self efficacy and response efficacy scores
=====================================================

Efficacy scores were collected in:
- every 3 days evening questionnaires (!! bug in the plateform, question was presented every day for some participants -> need to work out which and take every 3 day measures)

- questions scoring: 0 = not at all; 100 = very much

- response efficacy: Q3_1, Q3_2
- self-efficacy : q4_1, q4_2, q4_3
- hope: q7_1

1.Preprocessing

get filepaths

```{r}


eff_evening_filepath = "~/Documents/STUDY/EEG-Tobacco/DATA/SURVEYS/Every3days"

cond_file = "~/Documents/STUDY/EEG-Tobacco/DATA/expe_condition.csv"


output_filepath = "~/Documents/STUDY/EEG-Tobacco/DATA/SURVEYS"


```

read files

```{r}
# every 3 days evening survey
  
files_eff_eve <-dir(path= eff_evening_filepath, pattern = "*.csv") 

data_eff <-read.csv(file.path(eff_evening_filepath, files_eff_eve), header = TRUE, sep = ",", dec = ".")
as_tibble(data_eff)
    

# condition file
cond <- read_csv(cond_file)
as_tibble(cond)



```

rename columns 

```{r}

data_eff <-rename(data_eff, date=EndDate, completed=Finished, ID = Q1)

cond <-rename(cond, ID = "Subject ID", condition = "Condition = Intervention", removed= "REMOVED")
cond$ID<-as.factor(cond$ID)

```

Replace missing values and keep only participants who were not removed

```{r}
cond$removed<-cond$removed %>% replace(is.na(.), 0)

cond <-cond%>%filter(removed == 0)

```

filter to get only completed survey
```{r}
#filter to get only the completed = True
data_eff<-data_eff %>%filter(completed == 'True')
```


Arrange data by participants'ID 

```{r}

data_eff_tmp<- data_eff %>%  group_by(ID) 
%>%
  tally()
  
data_eff_tmp <- rename(data_eff_tmp, ev3days = n)
```







Get the difference between participant enrolled (= have a participant ID) and those who actually conpleted at least 1 survey

```{r}
# for data_day
test<-anti_join(cond, data_eff)
```




3. Collate data from all day and evening survey within the same dataframe

+ make sure we only look at data from real participant by taking only the IDs present on the condition file

```{r}
sum_data<- inner_join(cond, data_day_tmp, by = 'ID', copy=TRUE )
sum_data<-left_join(data_day_tmp,data_eve_tmp, by = 'ID', copy=TRUE)
sum_data<-left_join(sum_data, data_eff_tmp, by = 'ID', copy=TRUE)

## add information from condition file
sum_data<-left_join(sum_data, cond, by = 'ID', copy=TRUE)

# get only real participant in followup datasets

sum_data_followup <- inner_join(cond, data_followup, by = 'ID', copy=TRUE )

sum_data_followup_lab <- inner_join(cond, data_followup_lab, by = 'ID', copy=TRUE )


```



4. Overview of performance

Number of participants who completed 80% of daily surveys:

```{r}
sum(sum_data$day_msg >66)
```

Number of participants who completed between 50% and 80% of daily surveys:

```{r}
sum(sum_data$day_msg %in% 41:66)

```

Number of participants who completed less than 50% of daily surveys:

```{r}
sum(sum_data$day_msg %in% 1:40)
```

Number of participants who completed online follow up questionnaire:

```{r}
sum(sum_data_followup$completed == 'True')

```

Number of participants who completed lab based follow up questionnaire:
```{r}
sum(sum_data_followup_lab$completed == 'True')

```


Number of participants who dropped out from the start (ie. never completed an online survey):

```{r}
nrow(dropout)
```
















